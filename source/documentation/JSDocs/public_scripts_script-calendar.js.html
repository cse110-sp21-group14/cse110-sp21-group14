<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>public/scripts/script-calendar.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Calendar.html">Calendar</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DailySchema.html">DailySchema</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="JournalSchema.html">JournalSchema</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PageSchema.html">PageSchema</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="UserSchema.html">UserSchema</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-calendar%252520module.html">calendar module</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-decrypting%2520module.html">decrypting module</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-passport%2520module.html">passport module</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/auth/google">/auth/google</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/auth/google/callback">/auth/google/callback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/auth/logout">/auth/logout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/calendar">/calendar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/calendar/journals">/calendar/journals</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main">/main</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/:id/pages">/main/:id/pages</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/add/:journalId/page">/main/add/:journalId/page</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/add/journal">/main/add/journal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/daily">/main/daily</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/daily/:id">/main/daily/:id</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/daily/:month/:date/:year">/main/daily/:month/:date/:year</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/daily/:month/:year">/main/daily/:month/:year</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/journal">/main/journal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/journal/:id">/main/journal/:id</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/page/:id">/main/page/:id</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/page/:id/fetch">/main/page/:id/fetch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#/main/post/journal/:id">/main/post/journal/:id</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calendar">calendar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#connectDB">connectDB</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createCalendar">createCalendar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#express">express</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchEvents">fetchEvents</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchevents">fetchevents</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sum">sum</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">public/scripts/script-calendar.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * All of the logic behind the calendar view. The calendar is fully functional; users can view any month using previous and next buttons and all dates will generate correctly. It also fetches dailies from the database and populates the calendar.
 * @file public/scripts/script-calendar.js
 * @author Michael Mao
 */

/**
 * @constructor
 * @param {Model} model 
 * @param {Date} date 
 */
 var Calendar = function (model, date) {

    this.Model = model;
    this.Today = new Date();

    this.Selected = this.Today;
    this.Today.Month = this.Today.getMonth();
    this.Today.Year = this.Today.getFullYear();
    if (date) { this.Selected = date; }
    this.Selected.Month = this.Selected.getMonth();
    this.Selected.Year = this.Selected.getFullYear();

    this.Selected.Days = new Date(this.Selected.Year, (this.Selected.Month + 1), 0).getDate();
    this.Selected.FirstDay = new Date(this.Selected.Year, (this.Selected.Month), 1).getDay();
    this.Selected.LastDay = new Date(this.Selected.Year, (this.Selected.Month + 1), 0).getDay();

    this.Prev = new Date(this.Selected.Year, (this.Selected.Month - 1), 1);
    if (this.Selected.Month == 0) { this.Prev = new Date(this.Selected.Year - 1, 11, 1); }
    this.Prev.Days = new Date(this.Prev.getFullYear(), (this.Prev.getMonth() + 1), 0).getDate();
};

/**
 * Creates a calendar
 * @function
 * @param {Calendar} calendar 
 * @param {Element} element 
 * @param {*} adjuster 
 */
function createCalendar(calendar, element, adjuster) {
    var newDate = new Date(calendar.Selected.Year, calendar.Selected.Month, 1);
    if (typeof adjuster !== "undefined") {

        newDate = new Date(calendar.Selected.Year, calendar.Selected.Month, 1);
        calendar = new Calendar(calendar.Model, newDate);
        element.innerHTML = "";
    }

    var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    var mainSection = document.createElement("div");
    mainSection.className += "cld-main";

    /**
     * Creates today's date, next/prev month button in the HTML
     * @function
     */
    function AddDateTime() {
        var datetime = document.createElement("div");
        datetime.className += "cld-datetime";
        // prev month button. Pressing it calls our fetchevents function.
        var rwd = document.createElement("div");
        rwd.className += " cld-rwd cld-nav";
        rwd.addEventListener("click", function () {
            fetchevents(calendar.Selected.Month - 1, calendar.Selected.Year, calendar, element, -1);
        });
        rwd.innerHTML = `&lt;svg height="15" width="15" viewBox="0 0 75 100" fill="rgba(0,0,0,0.5)">&lt;polyline points="0,50 75,0 75,100">&lt;/polyline>&lt;/svg>`;
        datetime.appendChild(rwd);
        // shows today's date above
        var today = document.createElement("div");
        today.className += " today";
        today.innerHTML = months[calendar.Selected.Month] + ", " + calendar.Selected.Year;
        datetime.appendChild(today);
        // next month button. Pressing it calls our fetchevents function.
        var fwd = document.createElement("div");
        fwd.className += " cld-fwd cld-nav";
        fwd.addEventListener("click", function () {
            fetchevents(calendar.Selected.Month + 1, calendar.Selected.Year, calendar, element, 1);
        });
        fwd.innerHTML = `&lt;svg height="15" width="15" viewBox="0 0 75 100" fill="rgba(0,0,0,0.5)">&lt;polyline points="0,0 75,50 0,100">&lt;/polyline>&lt;/svg>`;
        datetime.appendChild(fwd);
        // append nav bar on top
        mainSection.appendChild(datetime);
    }

    /**
     * Adds weekday labels to the HTML
     * @function
     */
    function AddLabels() {
        var labels = document.createElement("ul");
        labels.className = "cld-labels";
        var labelsList = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        for (var i = 0; i &lt; labelsList.length; i++) {
            var label = document.createElement("li");
            label.className += "cld-label";
            label.innerHTML = labelsList[i];
            labels.appendChild(label);
        }
        mainSection.appendChild(labels);
    }

    /**
     * Add days to the HTML
     * @function
     */
    function AddDays() {
        /**
         * Create Number Element
         * @param {int} n 
         * @returns {number}
         */
        function DayNumber(n) {
            var number = document.createElement("p");
            number.className += "cld-number";
            number.innerHTML += n;
            return number;
        }
        var days = document.createElement("ul");
        days.className += "cld-days";
        // Previous Month's Days
        for (var i = 0; i &lt; (calendar.Selected.FirstDay); i++) {
            var day = document.createElement("li");
            day.className += "cld-day prevMonth";

            var number = DayNumber((calendar.Prev.Days - calendar.Selected.FirstDay) + (i + 1));
            day.appendChild(number);

            days.appendChild(day);
        }
        // Current Month's Days
        for (i = 0; i &lt; calendar.Selected.Days; i++) {
            day = document.createElement("li");
            day.className += "cld-day currMonth";

            number = DayNumber(i + 1);
            // Enters dailies into the calendar. Adds a button to open a daily view for each entry.
            for (var n = 0; n &lt; calendar.Model.length; n++) {
                var evDate = calendar.Model[n].Date;
                var toDate = new Date(calendar.Selected.Year, calendar.Selected.Month, (i + 1));
                //Creates the HTML behind each daily
                if (evDate.getTime() == toDate.getTime()) {
                    day.className += " eventday";
                    number.className += " eventday";
                    var title = document.createElement("span");
                    title.className += "cld-title";
                    //EventListener turns dailies into buttons
                    if (typeof calendar.Model[n].Link == "function") {
                        var a = document.createElement("a");
                        a.setAttribute("href", "#");
                        a.innerHTML += calendar.Model[n].Title;
                        a.addEventListener("click", calendar.Model[n].Link);
                        title.appendChild(a);
                    } else {
                        title.innerHTML += `&lt;a href="` + calendar.Model[n].Link + `">` + calendar.Model[n].Title + `&lt;/a>`;
                    }
                    number.appendChild(title);
                }
            }
            day.appendChild(number);
            // If Today..
            if ((i + 1) == calendar.Today.getDate() &amp;&amp; calendar.Selected.Month == calendar.Today.Month &amp;&amp; calendar.Selected.Year == calendar.Today.Year) {
                day.className += " today";
            }
            days.appendChild(day);
        }
        // Next Month's Days
        // Always same amount of days in calander
        var extraDays = 13;
        if (days.children.length > 35) { extraDays = 6; }
        else if (days.children.length &lt; 29) { extraDays = 20; }

        for (i = 0; i &lt; ((extraDays - calendar.Selected.LastDay) % 7); i++) {
            day = document.createElement("li");
            day.className += "cld-day nextMonth";

            number = DayNumber(i + 1);
            day.appendChild(number);

            days.appendChild(day);
        }
        mainSection.appendChild(days);
    }

    element.appendChild(mainSection);

    AddDateTime();
    AddLabels();
    AddDays();
}

var events = [];
let baseurl = window.location.href;
let curdate = new Date();
let month = curdate.getMonth();
let year = curdate.getFullYear();
var element = document.getElementById("calendar");

/**
 * Create calendar
 * @param {Element} el html element 
 * @param {Event} data array of events
 */
function calendar(el, data) {
    var obj = new Calendar(data);
    createCalendar(obj, el);
}

/**
 * Fetches events for a specified month and year and calls the calendar 
 * function. This function should only called once on page load.
 * @param {*} month 
 * @param {*} year 
 */
function fetchEvents(month, year) {
    fetch(baseurl.replace("calendar", "main") + "/daily/" + (1 + month) + "/" + year).then(response => response.json()).then(data => {
        events = []; //Clears entries to avoid duplicate entries
        /*
            fetches dailies from the database, parses its values, and enters it into the events array
        */
        for (let i = 0; i &lt; data.length; i++) {
            let newobj = {};
            newobj.Date = new Date(data[i].year + "-" + data[i].month + "-" + data[i].date);
            newobj.Title = data[i].title;
            newobj.Link = "main/daily/" + data[i].dailyId;
            events.push(newobj);
        }
        //create calendar for the first time
        calendar(element, events);

    });
}

/**
 * Fetches events for a specified month and year. Replaces old calendar with 
 * a new calendar. Adjuster is used to view the previous or next month.
 * @param {*} month 
 * @param {*} year 
 * @param {*} calendar 
 * @param {*} element 
 * @param {*} adjuster 
 */
function fetchevents(month, year, calendar, element, adjuster) {
    fetch(baseurl.replace("calendar", "main") + "/daily/" + (1 + month) + "/" + year).then(response => response.json()).then(data => {
        events = []; //Clears events array to avoid duplicate entries
        /*
            fetches dailies from the database, parses its values, and enters it into the events array
        */
        for (let i = 0; i &lt; data.length; i++) {
            let newobj = {};
            newobj.Date = new Date(data[i].year + "-" + data[i].month + "-" + data[i].date);
            newobj.Title = data[i].title;
            newobj.Link = "main/daily/" + data[i].dailyId;
            events.push(newobj);
        }
        //Replace old calendar with an updated calendar
        var newcalendar = new Calendar(events, new Date(calendar.Selected.Year, month, 1));
        createCalendar(newcalendar, element, adjuster);
    });
}

//Fetch dailies for the current month when loading calendar for the first time
fetchEvents(month, year);</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Wed Jun 09 2021 01:01:29 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
